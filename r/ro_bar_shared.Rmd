---
title: "ro_bar_shared"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}

ro_shared_asvs <- rownames(ro_bar_df)[ro_bar_df$`Kolea root`!=0 &
                                            ro_bar_df$`Grass root`!=0 &
                                            ro_bar_df$`Koa root`!=0 &
                                            ro_bar_df$`Akala root`!=0 &
                                            ro_bar_df$`Ohia root`!=0 &
                                            ro_bar_df$`Olapa root`!=0 &
                                            ro_bar_df$Soil!=0]

```



## shared Kolea

```{r}

# make new ro df with shared shared host asvs
ro_shared_kolea_df <- ro_bar_df[rownames(ro_bar_df) %in% ro_shared_asvs,]

# make asv rownames into a column
ro_shared_kolea_df <- ro_shared_kolea_df %>% rownames_to_column('ASV')

# make a new df with asv names and host sample asv counts as columns
ro_kolea_shared_df <- ro_shared_kolea_df %>% select(ASV, `Kolea root`)

# ttakee sum of all shared host sample sequences
ro_kolea_sum <- sum(ro_bar_df$`Kolea root`)

# make new relative abundance column by dividing shared count by total
ro_kolea_shared_df <- ro_kolea_shared_df %>% mutate(rel_abun = ((`Kolea root` / ro_kolea_sum) * 100))

# make new column troing family from tax_table where asv names match in both dfs
ro_kolea_shared_df$family <- ro_tax_table_df$Family[match(ro_kolea_shared_df$ASV, ro_tax_table_df$ASV)]

# make new column with host name filling all cells
ro_kolea_shared_df$Sample <- rep("Kolea root", nrow(ro_kolea_shared_df))

# change host colname for future rbind
colnames(ro_kolea_shared_df)[2] <- "Count"


```


## shared grass

```{r}

# make new ro df with shared shared host asvs
ro_shared_grass_df <- ro_bar_df[rownames(ro_bar_df) %in% ro_shared_asvs,]

# make asv rownames into a column
ro_shared_grass_df <- ro_shared_grass_df %>% rownames_to_column('ASV')

# make a new df with asv names and host sample asv counts as columns
ro_grass_shared_df <- ro_shared_grass_df %>% select(ASV, `Grass root`)

# take sum of all shared host sample sequences
ro_grass_sum <- sum(ro_bar_df$`Grass root`)

# make new relative abundance column by dividing shared count by total
ro_grass_shared_df <- ro_grass_shared_df %>% mutate(rel_abun = ((`Grass root` / ro_grass_sum) * 100))

# make new column troing family from tax_table where asv names match in both dfs
ro_grass_shared_df$family <- ro_tax_table_df$Family[match(ro_grass_shared_df$ASV, ro_tax_table_df$ASV)]

# make new column with host name filling all cells
ro_grass_shared_df$Sample <- rep("Grass root", nrow(ro_grass_shared_df))

# change host colname for future rbind
colnames(ro_grass_shared_df)[2] <- "Count"

```


## shared koa

```{r}


# make new ro df with shared shared host asvs
ro_shared_koa_df <- ro_bar_df[rownames(ro_bar_df) %in% ro_shared_asvs,]

# make asv rownames into a column
ro_shared_koa_df <- ro_shared_koa_df %>% rownames_to_column('ASV')

# make a new df with asv names and host sample asv counts as columns
ro_koa_shared_df <- ro_shared_koa_df %>% select(ASV, `Koa root`)

# take sum of all shared host sample sequences
ro_koa_sum <- sum(ro_bar_df$`Koa root`)

# make new relative abundance column by dividing shared count by total
ro_koa_shared_df <- ro_koa_shared_df %>% mutate(rel_abun = ((`Koa root` / ro_koa_sum) * 100))

# make new column troing family from tax_table where asv names match in both dfs
ro_koa_shared_df$family <- ro_tax_table_df$Family[match(ro_koa_shared_df$ASV, ro_tax_table_df$ASV)]

# make new column with host name filling all cells
ro_koa_shared_df$Sample <- rep("Koa root", nrow(ro_koa_shared_df))

# change host colname for future rbind
colnames(ro_koa_shared_df)[2] <- "Count"


```


## shared akala

```{r}

# make new ro df with shared shared host asvs
ro_shared_akala_df <- ro_bar_df[rownames(ro_bar_df) %in% ro_shared_asvs,]

# make asv rownames into a column
ro_shared_akala_df <- ro_shared_akala_df %>% rownames_to_column('ASV')

# make a new df with asv names and host sample asv counts as columns
ro_akala_shared_df <- ro_shared_akala_df %>% select(ASV, `Akala root`)

# take sum of all shared host sample sequences
ro_akala_sum <- sum(ro_bar_df$`Akala root`)

# make new relative abundance column by dividing shared count by total
ro_akala_shared_df <- ro_akala_shared_df %>% mutate(rel_abun = ((`Akala root` / ro_akala_sum) * 100))

# make new column troing family from tax_table where asv names match in both dfs
ro_akala_shared_df$family <- ro_tax_table_df$Family[match(ro_akala_shared_df$ASV, ro_tax_table_df$ASV)]

# make new column with host name filling all cells
ro_akala_shared_df$Sample <- rep("Akala root", nrow(ro_akala_shared_df))

# change host colname for future rbind
colnames(ro_akala_shared_df)[2] <- "Count"

```


## shared ohia

```{r}

# make new ro df with shared shared host asvs
ro_shared_ohia_df <- ro_bar_df[rownames(ro_bar_df) %in% ro_shared_asvs,]

# make asv rownames into a column
ro_shared_ohia_df <- ro_shared_ohia_df %>% rownames_to_column('ASV')

# make a new df with asv names and host sample asv counts as columns
ro_ohia_shared_df <- ro_shared_ohia_df %>% select(ASV, `Ohia root`)

# take sum of all shared host sample sequences
ro_ohia_sum <- sum(ro_bar_df$`Ohia root`)

# make new relative abundance column by dividing shared count by total
ro_ohia_shared_df <- ro_ohia_shared_df %>% mutate(rel_abun = ((`Ohia root` / ro_ohia_sum) * 100))

# make new column troing family from tax_table where asv names match in both dfs
ro_ohia_shared_df$family <- ro_tax_table_df$Family[match(ro_ohia_shared_df$ASV, ro_tax_table_df$ASV)]

# make new column with host name filling all cells
ro_ohia_shared_df$Sample <- rep("Ohia root", nrow(ro_ohia_shared_df))

# change host colname for future rbind
colnames(ro_ohia_shared_df)[2] <- "Count"

```


## shared olapa

```{r}

# make new ro df with shared shared host asvs
ro_shared_olapa_df <- ro_bar_df[rownames(ro_bar_df) %in% ro_shared_asvs,]

# make asv rownames into a column
ro_shared_olapa_df <- ro_shared_olapa_df %>% rownames_to_column('ASV')

# make a new df with asv names and host sample asv counts as columns
ro_olapa_shared_df <- ro_shared_olapa_df %>% select(ASV, `Olapa root`)

# take sum of all shared host sample sequences
ro_olapa_sum <- sum(ro_bar_df$`Olapa root`)

# make new relative abundance column by dividing shared count by total
ro_olapa_shared_df <- ro_olapa_shared_df %>% mutate(rel_abun = ((`Olapa root` / ro_olapa_sum) * 100))

# make new column troing family from tax_table where asv names match in both dfs
ro_olapa_shared_df$family <- ro_tax_table_df$Family[match(ro_olapa_shared_df$ASV, ro_tax_table_df$ASV)]

# make new column with host name filling all cells
ro_olapa_shared_df$Sample <- rep("Olapa root", nrow(ro_olapa_shared_df))

# change host colname for future rbind
colnames(ro_olapa_shared_df)[2] <- "Count"

```


## shared soil

```{r}

# make new ro df with shared shared host asvs
ro_shared_soil_df <- ro_bar_df[rownames(ro_bar_df) %in% ro_shared_asvs,]

# make asv rownames into a column
ro_shared_soil_df <- ro_shared_soil_df %>% rownames_to_column('ASV')

# make a new df with asv names and host sample asv counts as columns
ro_soil_shared_df <- ro_shared_soil_df %>% select(ASV, `Soil`)

# take sum of all shared host sample sequences
ro_soil_sum <- sum(ro_bar_df$`Soil`)

# make new relative abundance column by dividing shared count by total
ro_soil_shared_df <- ro_soil_shared_df %>% mutate(rel_abun = ((`Soil` / ro_soil_sum) * 100))

# make new column troing family from tax_table where asv names match in both dfs
ro_soil_shared_df$family <- ro_tax_table_df$Family[match(ro_soil_shared_df$ASV, ro_tax_table_df$ASV)]

# make new column with host name filling all cells
ro_soil_shared_df$Sample <- rep("Soil", nrow(ro_soil_shared_df))

# change host colname for future rbind
colnames(ro_soil_shared_df)[2] <- "Count"

```


## rbind

```{r}

ro_total_shared_rbind <- do.call("rbind", list(ro_kolea_shared_df,
                                        ro_grass_shared_df,
                                        ro_koa_shared_df,
                                        ro_akala_shared_df,
                                        ro_ohia_shared_df,
                                        ro_olapa_shared_df,
                                        ro_soil_shared_df))


```


## Plot

```{r}

ro_shared_bar <- ggplot(ro_total_shared_rbind, aes(x=Sample, fill=family, y=rel_abun)) +
  geom_bar(stat="identity", position="stack") +
  theme(axis.text.x = element_text(angle=90, size=14, colour="black", vjust=0.5, hjust=1, face="bold"), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),
        axis.line = element_line(colour="gray"),
        axis.title.y = element_text(size=16, face="bold"),
        legend.title = element_text(size=16, face="bold"),
        legend.text = element_text(size=12, face="bold", colour="black"),
        axis.text.y = element_text(colour="black", size=12, face="bold")) +
  ylim(0,100) +
  theme(plot.margin = unit(c(1,1,1,1), "cm")) +
  labs(x = "", y = "Relative Abundance (%)", fill="Family") +
  #match colors to unique plot
  scale_fill_manual(values = c("Acaulosporaceae" = "#9e0142",
                               "Ambisporaceae" = "#d53e4f",
                               "Archaeosporaceae" = "#f46d43",
                               "Claroideoglomeraceae" = "#fdae61",
                               "Gigasporaceae" = "#abdda4",
                               "Glomeraceae" = "#66c2a5",
                               "Glomeromycotina" = "#3288bd",
                               "Paraglomeraceae" = "#5e4fa2"))

```




